## Sed
sed是一种流编辑器，它是文本处理中非常有用的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为『模式空间』（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有改变，除非你使用重定向存储输出。sed主要用来自动编辑一个或多个文件，简化对文件的反复操作，编写转换程序等。

### sed的命令格式、选项、命令、替换标记

#### 命令格式

```
sed [options] 'command' file(s)
sed [options] -f scriptfile file(s)
```

#### 选项

| 参数      | 完整参数            | 说明                                           |
| --------- | ------------------- | ---------------------------------------------- |
| -e script | --expression=script | 以选项中的指定的script来处理输入的文本文件     |
| -f script | --files=script      | 以选项中的指定的script文件来处理输入的文本文件 |
| -h        | --help              | 显示帮助                                       |
| -n        | --quiet --silent    | 仅显示script处理后的结果                       |
| -V        | --version           | 显示版本信息                                   |

#### 命令

| 命令    | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| d       | 删除，删除选择的行                                           |
| D       | 删除模板块的第一行                                           |
| s       | 替换指定字符                                                 |
| h       | 拷贝模板块的内容到内存中的缓冲区                             |
| H       | 追加模板块的内容到内存中的缓冲区                             |
| g       | 获得内存缓冲区的内容，并替代当前模板块中文本                 |
| G       | 获得内存缓冲区的内容，并追加到当前模板块文本的后面           |
| l       | 列表不能打印字符的清单                                       |
| n       | 读取下一个输入行，用下一个命令处理新的行而不是第一个命令     |
| N       | 追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码 |
| p       | 打印模板块的行                                               |
| P       | 打印模板块的第一行                                           |
| q       | 退出sed                                                      |
| b label | 分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾 |
| r file  | 从file中读行                                                 |
| t label | if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾 |
| T label | 错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾 |
| w file  | 写并追加模板块到file末尾                                     |
| W file  | 写并追加模板块的第一行到file末尾                             |
| !       | 表示后面的命令对所有没有被选定的行发生作用                   |
| =       | 打印当前行号                                                 |
| #       | 把注释扩展到第一个换行符以前                                 |

#### sed替换标记

| 命令 | 说明                                                   |
| ---- | ------------------------------------------------------ |
| g    | 表示行内全面替换                                       |
| p    | 表示打印行                                             |
| w    | 表示把行写入一个文件                                   |
| x    | 表示互换模板块中的文本和缓冲区中的文本                 |
| y    | 表示把一个字符翻译为另外的字符（但是不用于正则表达式） |
| \1   | 子串匹配标记                                           |
| &    | 已匹配字符串标记                                       |

#### Sed元字符集

| 命令   | 说明                                                         |
| ------ | ------------------------------------------------------------ |
| ^      | 匹配行开始，如：/^sed/匹配所有以sed开头的行。                |
| $      | 匹配行结束，如：/sed$/匹配所有以sed结尾的行。                |
| .      | 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。 |
| *      | 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。 |
| []     | 匹配一个指定范围内的字符，如/[sS]ed/匹配sed和Sed。           |
| [^]    | 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。 |
| (..)   | 匹配子串，保存匹配的字符，如s/(love)able/\1rs，loveable被替换成lovers。 |
| &      | 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。 |
| <      | 匹配单词的开始，如:/<love/匹配包含以love开头的单词的行。     |
| \ >    | 匹配单词的结束，如/love>/匹配包含以love结尾的单词的行。      |
| x{m}   | 重复字符x，m次，如：/0{5}/匹配包含5个0的行。                 |
| x{m,}  | 重复字符x，至少m次，如：/0{5,}/匹配至少有5个0的行。          |
| x{m,n} | 重复字符x，至少m次，不多于n次，如：/0{5,10}/匹配5~10个0的行。 |



### 基本操作

#### 替换

+ 测试文件

```
cat test.txt
my cat's name is betty
This is your dog
my dog's name is frank
This is your fish
my fish's name is george
This is your goat
my goat's name is adam
```

+ 替换文本中的字符串,把`this` 替换成 `aaa`

```
$ sed 's/This/aaa/' test.txt
my cat's name is betty
aaa is your dog
my dog's name is frank
aaa is your fish
my fish's name is george
aaa is your goat
my goat's name is adam
```

+ -n选项和p命令一起使用表示只打印那些发生替换的行

```
$ sed -n 's/This/aaa/p' test.txt
aaa is your dog
aaa is your fish
aaa is your goat
```



